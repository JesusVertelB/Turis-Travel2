@model Turis_Travel2.Models.ViewModels.DestinosPaquetesViewModel

@{
    ViewData["Title"] = "Detalle del Destino";
    Layout = "~/Views/Shared/_LayoutUsuarios.cshtml";
    var destino = Model.Destino;
    var paquetes = Model.Paquetes;

    var promedio = ViewBag.PromedioCalificacion ?? 0;
    var total = ViewBag.TotalOpiniones ?? 0;
    var estrellas = (int)Math.Round((double)promedio);
}

<div class="relative flex min-h-screen w-full flex-col group/design-root overflow-x-hidden">
    <div class="layout-container flex h-full grow flex-col">
        <main class="flex-1 px-4 py-8 sm:px-6 lg:px-8">
            <div class="max-w-7xl mx-auto flex flex-col gap-8">
                <!-- Breadcrumb -->
                <div class="flex flex-wrap gap-2 text-sm">
                    <a asp-controller="HomeUsuario" asp-action="Index" class="text-neutral-500 font-medium">Inicio</a>
                    <span class="text-neutral-500 ">/</span>
                    <a class="text-neutral-500 font-medium" asp-action="Destinos">Destinos</a>
                    <span class="text-neutral-500 ">/</span>
                    <span class="text-neutral-900 font-medium">@destino.Nombre</span>
                </div>

                <!-- Título y descripción -->
                <div class="flex flex-col gap-4">
                    <p class="text-neutral-900 text-4xl lg:text-5xl font-black tracking-[-0.033em]">
                        Descubre las Maravillas de @destino.Nombre, @destino.Pais
                    </p>
                    <p class="text-neutral-500 text-lg">@destino.Descripcion</p>
                </div>

                <!-- Imagen principal -->
                <div class="grid grid-cols-2 md:grid-cols-4 gap-4 h-[500px]">
                    <div class="col-span-4 row-span-4 rounded-xl overflow-hidden">
                        <div class="w-full h-full bg-center bg-no-repeat bg-cover"
                             data-alt="@destino.Nombre"
                             style='background-image: url("@destino.ImagenUrl");'></div>
                    </div>
                </div>

                <!-- Calificación y botones -->
                <div class="sticky top-[65px] z-40 flex items-center justify-between gap-4 p-4 -mx-4 bg-background-light/80 backdrop-blur-sm border-y border-neutral-100 ">
                    <div class="flex items-center gap-4">
                        <div class="flex items-center gap-1">
                            @for (int i = 1; i <= 5; i++)
                            {
                                if (i <= estrellas)
                                {
                                    <span class="material-symbols-outlined text-yellow-500" style="font-variation-settings: 'FILL' 1;">star</span>
                                }
                                else
                                {
                                    <span class="material-symbols-outlined text-neutral-300">star</span>
                                }
                            }
                            <span class="font-bold text-neutral-900">@promedio</span>
                            <span class="text-sm text-neutral-500">(@total opiniones)</span>
                        </div>
                    </div>

                    <div class="flex items-center gap-2">
                        <button class="p-2 rounded-lg hover:bg-neutral-100 text-neutral-500">
                            <span class="material-symbols-outlined">favorite_border</span>
                        </button>
                        <button class="p-2 rounded-lg hover:bg-neutral-100 text-neutral-500">
                            <span class="material-symbols-outlined">share</span>
                        </button>
                        <a asp-controller="HomeUsuario" asp-action="ConfigurarViaje" asp-route-id="@destino.Id"
                           class="flex items-center gap-2 px-4 py-2 rounded-xl bg-blue-600 text-white font-semibold text-sm hover:bg-blue-700 transition">
                            <span class="material-symbols-outlined text-white">calendar_month</span>
                            Configurar viaje
                        </a>
                    </div>
                </div>

                <!-- Descripción y puntos de interés -->
                <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                    <div class="lg:col-span-2 flex flex-col gap-8">
                        <div>
                            <h3 class="text-2xl font-bold text-neutral-900 mb-4">Descripción General</h3>
                        </div>
                        <div>
                            <h3 class="text-2xl font-bold text-neutral-900 mb-4">Puntos de Interés</h3>
                            <div class="grid grid-cols-1 sm:grid-cols-2 gap-6">
                                <!-- Ejemplos de puntos de interés -->
                                <div class="flex items-start gap-4">
                                    <span class="material-symbols-outlined text-primary mt-1">account_balance</span>
                                    <div>
                                        <h4 class="font-bold text-neutral-900">Santuario Fushimi Inari</h4>
                                        <p class="text-sm text-neutral-500">Camina a través de miles de puertas torii rojas en uno de los santuarios más famosos de Japón.</p>
                                    </div>
                                </div>
                                <div class="flex items-start gap-4">
                                    <span class="material-symbols-outlined text-primary mt-1">forest</span>
                                    <div>
                                        <h4 class="font-bold text-neutral-900">Bosque de Bambú de Arashiyama</h4>
                                        <p class="text-sm text-neutral-500">Piérdete en la serenidad de un imponente bosque de bambú.</p>
                                    </div>
                                </div>
                                <div class="flex items-start gap-4">
                                    <span class="material-symbols-outlined text-primary mt-1">fort</span>
                                    <div>
                                        <h4 class="font-bold text-neutral-900">Templo Kinkaku-ji</h4>
                                        <p class="text-sm text-neutral-500">Maravíllate con el Pabellón Dorado, cubierto de pan de oro y reflejado en un estanque.</p>
                                    </div>
                                </div>
                                <div class="flex items-start gap-4">
                                    <span class="material-symbols-outlined text-primary mt-1">theater_comedy</span>
                                    <div>
                                        <h4 class="font-bold text-neutral-900">Barrio de Gion</h4>
                                        <p class="text-sm text-neutral-500">Explora el famoso distrito de las geishas, con sus casas de té y su arquitectura tradicional.</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Información clave -->
                    <div class="lg:col-span-1">
                        <div class="p-6 bg-white rounded-xl shadow-lg border border-neutral-100">
                            <h3 class="text-xl font-bold text-neutral-900 mb-4">Información Clave</h3>
                            <div class="flex flex-col gap-4">
                                <div class="flex items-center gap-3">
                                    <span class="material-symbols-outlined text-neutral-500">calendar_today</span>
                                    <div>
                                        <p class="text-sm text-neutral-500">Mejor época para visitar</p>
                                        <p class="font-semibold text-neutral-900">Marzo-Mayo, Oct-Nov</p>
                                    </div>
                                </div>
                                <div class="flex items-center gap-3">
                                    <span class="material-symbols-outlined text-neutral-500">translate</span>
                                    <div>
                                        <p class="text-sm text-neutral-500">Idioma</p>
                                        <p class="font-semibold text-neutral-900">Japonés</p>
                                    </div>
                                </div>
                                <div class="flex items-center gap-3">
                                    <span class="material-symbols-outlined text-neutral-500">payments</span>
                                    <div>
                                        <p class="text-sm text-neutral-500">Moneda</p>
                                        <p class="font-semibold text-neutral-900">Yen Japonés (JPY)</p>
                                    </div>
                                </div>
                                <div class="flex items-center gap-3">
                                    <span class="material-symbols-outlined text-neutral-500">schedule</span>
                                    <div>
                                        <p class="text-sm text-neutral-500">Zona Horaria</p>
                                        <p class="font-semibold text-neutral-900">GMT+9</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Paquetes de viaje -->
                <div class="py-8">
                    <h3 class="text-3xl font-bold text-neutral-900 mb-6 text-center">Paquetes de Viaje Sugeridos</h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                        @foreach (var paquete in paquetes)
                        {
                            <div class="bg-white rounded-2xl shadow-md hover:shadow-xl hover:-translate-y-1 transition-all duration-300 border border-neutral-100 flex flex-col relative">
                                @if (paquete.Estado == "Popular")
                                {
                                    <span class="absolute top-3 right-3 bg-primary text-white text-xs font-bold px-3 py-1 rounded-full">
                                        MÁS POPULAR
                                    </span>
                                }

                                @if (!string.IsNullOrEmpty(paquete.ImagenUrl))
                                {
                                    <div class="h-44 w-full bg-cover bg-center rounded-t-2xl"
                                         style="background-image:url('@paquete.ImagenUrl')"></div>
                                }

                                <div class="p-6 flex-1 flex flex-col">
                                    <h4 class="text-xl font-bold text-primary">@paquete.NombrePaquete</h4>

                                    <p class="text-3xl font-extrabold text-neutral-900 mb-3">
                                        @paquete.PrecioBase.ToString("N0") €
                                        <span class="text-base font-normal text-neutral-500">/persona</span>
                                    </p>

                                    <p class="text-sm text-neutral-500 line-clamp-3 mb-4">@paquete.Descripcion</p>

                                    <div class="mt-auto">
                                        <a asp-controller="HomeUsuario"
                                           asp-action="ConfigurarViaje"
                                           asp-route-paqueteId="@paquete.IdPaquete"
                                           asp-route-destinoId="@destino.Id"
                                           class="w-full flex items-center justify-center gap-2 rounded-xl h-12 bg-blue-600 text-white text-sm font-extrabold shadow-md hover:shadow-lg hover:scale-[1.02] transition-all duration-300">
                                            Seleccionar Paquete
                                        </a>
                                    </div>
                                </div>
                            </div>
                        }
                    </div> <!-- cierre grid paquetes -->
                    <!-- Opiniones de los viajeros -->
                    <div class="mt-8">
                        <h3 class="text-2xl font-bold text-neutral-900 mb-4">Opiniones de los viajeros</h3>

                        @if (!Model.Comentarios.Any())
                        {
                            <p class="text-neutral-500">Aún no hay opiniones para este destino.</p>
                        }
                        else
                        {
                            @foreach (var comentario in Model.Comentarios)
                            {
                                <div class="mb-4 p-4 border rounded-xl bg-white shadow-sm">
                                    <div class="flex items-center mb-2">
                                        @{
                                            int estrellasComentario = comentario.Puntuacion ?? 0;
                                            for (int i = 1; i <= 5; i++)
                                            {
                                                if (i <= estrellasComentario)
                                                {
                                                    <span class="material-symbols-outlined text-yellow-500" style="font-variation-settings: 'FILL' 1;">star</span>
                                                }
                                                else
                                                {
                                                    <span class="material-symbols-outlined text-neutral-300">star</span>
                                                }
                                            }
                                        }
                                    </div>
                                    <p class="text-sm text-neutral-500 mb-1">@comentario.IdReservaNavigation?.IdClienteNavigation?.Nombre ?? "Usuario"</p>
                                    <p class="text-neutral-900">@comentario.Comentario</p>
                                </div>
                            }
                        }
                    </div>
                </div> <!-- cierre py-8 paquetes y opiniones -->

            </div> <!-- max-w-7xl -->
        </main>
    </div> <!-- layout-container -->
</div> <!-- group/design-root -->
